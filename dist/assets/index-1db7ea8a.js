import{H as V,d as pe,r as i,c as D,C as ce,e as p,o as z,f as M,g as l,w as t,h as n,A as k,k as m,i as j,t as $,p as B,m as fe,F as ge,n as _e,x as G,I as _,_ as ve}from"./index-39dd0681.js";import{u as ye}from"./setting-10e9cb60.js";const be=(d,q,u)=>V.get(`/admin/acl/user/${d}/${q}/?username=${u}`),Ve=d=>d.id?V.put("/admin/acl/user/update",d):V.post("/admin/acl/user/save",d),Ce=d=>V.get("/admin/acl/user/toAssign/"+d),ke=d=>V.post("/admin/acl/user/doAssignRole",d),Ue=d=>V.delete("/admin/acl/user/remove/"+d),we=d=>V.delete("/admin/acl/user/batchRemove",{data:d}),xe={style:{flex:"auto"}},Re=pe({__name:"index",setup(d){let q=ye(),u=i(1),U=i(3),L=i(0),w=i([]),g=i(!1),s=D({name:"",username:"",password:""}),N=i(),v=i(!1),x=i([]),R=i(!1);const A=i(!1),S=i([]);let I=i([]),C=i("");ce(()=>{y()});const J=()=>{y(u.value)},K=()=>{Object.assign(s,{id:0,name:"",username:"",password:""}),g.value=!0,G(()=>{N.value.clearValidate()})},Q=o=>{g.value=!0,Object.assign(s,o),G(()=>{N.value.clearValidate()})},W=async()=>{await N.value.validate(),(await Ve(s)).code===200?(_({type:"success",message:s.id?"修改成功":"添加成功"}),window.location.reload(),g.value=!1,y(u.value)):_({type:"error",message:s.id?"修改失败":"添加失败"})},X=D({username:[{required:!0,trigger:"blur",validator:(o,e,r)=>{console.log(o),console.log(w),e.trim().length>=5?r():r(new Error("用户姓名至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=5?r():r(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=6?r():r(new Error("用户密码至少六位"))}}]}),Y=()=>{g.value=!1},y=async(o=1)=>{u.value=o;let e=await be(u.value,U.value,C.value);e.code===200&&(L.value=e.data.total,w.value=e.data.records)},Z=async o=>{let e=await Ce(o.id);console.log(e),console.log(e.data,"111"),x.value=e.data.allRolesList,S.value=e.data.assignRoles,v.value=!0,Object.assign(s,o)},h=o=>{S.value=o?x.value:[],A.value=!1},ee=o=>{const e=o.length;R.value=e===x.value.length,A.value=e>0&&e<x.value.length},le=()=>{v.value=!1},ae=async()=>{let o={roleIdList:S.value.map(r=>r.id),userId:s.id},e=await ke(o);console.log(e),e.code===200?(_({type:"success",message:"分配成功！"}),v.value=!1,y(u.value)):_({type:"error",message:"分配失败！"})},te=async o=>{(await Ue(o.id)).code===200?(_({type:"success",message:"删除成功！"}),y(w.value.length>1?u.value:u.value-1)):_({type:"error",message:"删除失败！"})},oe=async o=>{I.value=o.map(e=>e.id)},ne=async()=>{(await we(I.value)).code===200?(_({type:"success",message:"删除成功！"}),y(w.value.length>1?u.value:u.value-1)):_({type:"error",message:"删除失败！"})},se=()=>{y()},re=()=>{q.refsh=!q.refsh};return(o,e)=>{const r=p("el-input"),b=p("el-form-item"),c=p("el-button"),E=p("el-form"),O=p("el-card"),f=p("el-table-column"),ue=p("el-popconfirm"),de=p("el-table"),ie=p("el-pagination"),P=p("el-drawer"),F=p("el-checkbox"),me=p("el-checkbox-group");return z(),M("div",null,[l(O,null,{default:t(()=>[l(E,{inline:"true",class:"top"},{default:t(()=>[l(b,{label:"用户",style:{width:"30%"}},{default:t(()=>[l(r,{placeholder:"请输入用户名",modelValue:n(C),"onUpdate:modelValue":e[0]||(e[0]=a=>k(C)?C.value=a:C=a)},null,8,["modelValue"])]),_:1}),l(b,null,{default:t(()=>[l(c,{type:"success",disabled:!n(C),onClick:se},{default:t(()=>e[11]||(e[11]=[m(" 搜索 ")])),_:1,__:[11]},8,["disabled"]),l(c,{type:"success",onClick:re},{default:t(()=>e[12]||(e[12]=[m("重置")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1}),l(O,{style:{"margin-top":"10px"}},{default:t(()=>[l(c,{type:"primary",onClick:K},{default:t(()=>e[13]||(e[13]=[m("添加")])),_:1,__:[13]}),l(c,{type:"warning",onClick:ne,disabled:!n(I).length},{default:t(()=>e[14]||(e[14]=[m(" 批量删除 ")])),_:1,__:[14]},8,["disabled"]),l(de,{border:"",style:{margin:"10px 0"},data:n(w),onSelectionChange:oe},{default:t(()=>[l(f,{type:"selection"}),l(f,{type:"index",label:"#",align:"center"}),l(f,{label:"id",align:"center",prop:"id"}),l(f,{label:"用户名字",align:"center",prop:"name"}),l(f,{label:"用户名称",align:"center",prop:"username"}),l(f,{label:"用户角色",align:"center",prop:"roleName"}),l(f,{label:"创建时间",align:"center",prop:"createTime"}),l(f,{label:"更新时间",align:"center",prop:"updateTime"}),l(f,{label:"操作",width:"300px"},{default:t(({row:a,$index:T})=>[l(c,{type:"primary",size:"small",icon:"UserFilled",onClick:H=>Z(a)},{default:t(()=>e[15]||(e[15]=[m(" 分配职位 ")])),_:2,__:[15]},1032,["onClick"]),l(c,{type:"primary",size:"small",icon:"Edit",onClick:H=>Q(a)},{default:t(()=>e[16]||(e[16]=[m(" 编辑 ")])),_:2,__:[16]},1032,["onClick"]),l(ue,{title:`你确定删除${a.name}吗？`,onConfirm:H=>te(a)},{reference:t(()=>[l(c,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>e[17]||(e[17]=[m(" 删除 ")])),_:1,__:[17]})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(ie,{"current-page":n(u),"onUpdate:currentPage":e[1]||(e[1]=a=>k(u)?u.value=a:u=a),"page-size":n(U),"onUpdate:pageSize":e[2]||(e[2]=a=>k(U)?U.value=a:U=a),"page-sizes":[3,5,7,9],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:n(L),onChange:J},null,8,["current-page","page-size","total"])]),_:1}),l(P,{modelValue:n(g),"onUpdate:modelValue":e[6]||(e[6]=a=>k(g)?g.value=a:g=a),title:"I am the title"},{header:t(()=>[j("span",null,$(n(s).id?"修改用户信息":"添加用户信息"),1)]),default:t(()=>[l(E,{model:n(s),rules:X,ref_key:"formRef",ref:N,style:{"margin-top":"20px"}},{default:t(()=>[l(b,{label:"用户姓名",prop:"username"},{default:t(()=>[l(r,{placeholder:"请输入用户姓名",modelValue:n(s).username,"onUpdate:modelValue":e[3]||(e[3]=a=>n(s).username=a)},null,8,["modelValue"])]),_:1}),l(b,{label:"用户昵称",prop:"name"},{default:t(()=>[l(r,{placeholder:"请输入用户昵称",modelValue:n(s).name,"onUpdate:modelValue":e[4]||(e[4]=a=>n(s).name=a)},null,8,["modelValue"])]),_:1}),n(s).id?fe("",!0):(z(),B(b,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(r,{placeholder:"请输入用户密码",modelValue:n(s).password,"onUpdate:modelValue":e[5]||(e[5]=a=>n(s).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model","rules"])]),footer:t(()=>[l(c,{type:"primary",icon:"UserFilled",onClick:Y},{default:t(()=>e[18]||(e[18]=[m(" 取消 ")])),_:1,__:[18]}),l(c,{type:"primary",icon:"Edit",onClick:W},{default:t(()=>e[19]||(e[19]=[m("确认")])),_:1,__:[19]})]),_:1},8,["modelValue"]),l(P,{modelValue:n(v),"onUpdate:modelValue":e[10]||(e[10]=a=>k(v)?v.value=a:v=a)},{header:t(()=>e[20]||(e[20]=[j("h4",null,"用户角色分配",-1)])),default:t(()=>[l(E,null,{default:t(()=>[l(b,{label:"用户姓名"},{default:t(()=>[l(r,{modelValue:n(s).name,"onUpdate:modelValue":e[7]||(e[7]=a=>n(s).name=a),disabled:""},null,8,["modelValue"])]),_:1}),l(b,{label:"职位列表"},{default:t(()=>[l(F,{modelValue:n(R),"onUpdate:modelValue":e[8]||(e[8]=a=>k(R)?R.value=a:R=a),indeterminate:A.value,onChange:h},{default:t(()=>e[21]||(e[21]=[m(" 全选 ")])),_:1,__:[21]},8,["modelValue","indeterminate"]),l(me,{modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=a=>S.value=a),onChange:ee},{default:t(()=>[(z(!0),M(ge,null,_e(n(x),(a,T)=>(z(),B(F,{key:T,label:a,value:a},{default:t(()=>[m($(a.roleName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[j("div",xe,[l(c,{onClick:le},{default:t(()=>e[22]||(e[22]=[m("取消")])),_:1,__:[22]}),l(c,{type:"primary",onClick:ae},{default:t(()=>e[23]||(e[23]=[m("确认")])),_:1,__:[23]})])]),_:1},8,["modelValue"])])}}});const Ie=ve(Re,[["__scopeId","data-v-e0802063"]]);export{Ie as default};
