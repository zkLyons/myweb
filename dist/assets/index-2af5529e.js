import{d as M,O as Q,r as k,c as G,v as H,P as W,D as X,e as i,K as Y,o as g,f as C,g as t,h as o,i as B,y,z as O,w as l,p as L,k as m,F as Z,n as ee,t as S,L as te,N as ae,Q as le,I as _,x as D,R as ne}from"./index-39dd0681.js";const re={style:{margin:"10px 0px"}},se=["onClick"],ue=M({__name:"index",setup(oe){let u=Q(),b=k([]),c=k(0),n=G({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),x=k([]);H(()=>u.c3Id,()=>{b.value=[],u.c3Id&&V()});const V=async()=>{const{c1Id:a,c2Id:e,c3Id:v}=u;let s=await W(a,e,v);s.code==200&&(b.value=s.data)},U=()=>{Object.assign(n,{attrName:"",attrValueList:[],categoryId:u.c3Id,categoryLevel:3}),c.value=1,n.categoryId=u.c3Id},z=a=>{c.value=1,Object.assign(n,JSON.parse(JSON.stringify(a)))},A=()=>{c.value=0},E=async a=>{(await le(a)).code==200?(_({type:"success",message:"删除成功"}),V()):_({type:"error",message:"删除失败"})},$=()=>{n.attrValueList.push({valueName:"",flag:!0}),D(()=>{x.value[n.attrValueList.length-1].focus()})},q=async()=>{if(!n.attrValueList.length){_({type:"error",message:"未添加任何属性值！"});return}let a=await ne(n);a.code==200?(c.value=0,_({type:"success",message:n.id?"修改成功":"添加成功"}),V()):_({type:"error",message:n.id?"修改失败":"添加失败"}),console.log(a)},P=(a,e)=>{if(a.valueName.trim()===""){n.attrValueList.splice(e,1),_({type:"error",message:"值不能为空！"});return}if(n.attrValueList.filter(s=>s.valueName===a.valueName).length>1){_({type:"error",message:"值不能重复！"}),n.attrValueList.splice(e,1);return}a.flag=!1},j=(a,e)=>{a.flag=!0,D(()=>{x.value[e].focus()})},F=(a,e)=>{console.log(a,11),x.value[e]=a};return X(()=>{u.$reset()}),(a,e)=>{const v=i("Category"),s=i("el-button"),p=i("el-table-column"),J=i("el-tag"),R=i("el-popconfirm"),I=i("el-table"),h=i("el-card"),w=i("el-input"),T=i("el-form-item"),K=i("el-form"),N=Y("has");return g(),C("div",null,[t(v,{scence:o(c)},null,8,["scence"]),B("div",null,[y(t(h,{style:{margin:"10px 0px"}},{default:l(()=>[y((g(),L(s,{type:"primary",size:"default",icon:"Plus",disabled:!o(u).c3Id,onClick:U},{default:l(()=>e[1]||(e[1]=[m(" 添加属性 ")])),_:1,__:[1]},8,["disabled"])),[[N,"btn.Attr.add"]]),t(I,{stripe:"",border:"",data:o(b),style:{margin:"10px 0"}},{default:l(()=>[t(p,{label:"序号",align:"center",width:"120px",type:"index"}),t(p,{label:"属性名称",align:"center",width:"120px",prop:"attrName"}),t(p,{label:"属性值名称",align:"center"},{default:l(({row:r,$index:f})=>[(g(!0),C(Z,null,ee(r.attrValueList,(d,ie)=>(g(),L(J,{style:{margin:"5px"},key:d.id},{default:l(()=>[m(S(d.valueName),1)]),_:2},1024))),128))]),_:1}),t(p,{label:"操作",align:"center",width:"120px"},{default:l(({row:r,$index:f})=>[y(t(s,{type:"primary",size:"small",icon:"Edit",onClick:d=>z(r)},null,8,["onClick"]),[[N,"btn.Attr.update"]]),t(R,{title:`你确定删除${r.attrName}?`,width:"200px",onConfirm:d=>E(r.id)},{reference:l(()=>[y(t(s,{type:"primary",size:"small",icon:"Delete"},null,512),[[N,"btn.Attr.delete"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1},512),[[O,o(c)==0]])]),y(B("div",re,[t(h,null,{default:l(()=>[t(K,null,{default:l(()=>[t(T,{label:"属性名称：",style:{width:"300px"}},{default:l(()=>[t(w,{placeholder:"请输入属性的名称",modelValue:o(n).attrName,"onUpdate:modelValue":e[0]||(e[0]=r=>o(n).attrName=r)},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{type:"primary",disabled:!o(n).attrName,icon:o(te),onClick:$},{default:l(()=>e[2]||(e[2]=[m(" 添加属性值 ")])),_:1,__:[2]},8,["disabled","icon"]),t(s,{type:"primary",onClick:A},{default:l(()=>e[3]||(e[3]=[m("取消")])),_:1,__:[3]}),t(I,{border:"",style:{margin:"10px 0"},data:o(n).attrValueList},{default:l(()=>[t(p,{label:"序号",type:"index",align:"center",width:"80px"}),t(p,{label:"属性值",align:"center"},{default:l(({row:r,$index:f})=>[r.flag?(g(),L(w,{key:0,ref:d=>F(d,f),modelValue:r.valueName,"onUpdate:modelValue":d=>r.valueName=d,onBlur:()=>P(r,f)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(g(),C("div",{key:1,onClick:()=>j(r,f)},S(r.valueName),9,se))]),_:1}),t(p,{label:"操作",align:"center",width:"180px"},{default:l(({$index:r})=>[t(s,{type:"warning",icon:o(ae),onClick:f=>o(n).attrValueList.splice(r,1)},{default:l(()=>e[4]||(e[4]=[m(" 删除 ")])),_:2,__:[4]},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"]),t(s,{type:"primary",onClick:q},{default:l(()=>e[5]||(e[5]=[m("保存")])),_:1,__:[5]}),t(s,{type:"primary",onClick:A},{default:l(()=>e[6]||(e[6]=[m("取消")])),_:1,__:[6]})]),_:1})],512),[[O,o(c)==1]])])}}});export{ue as default};
