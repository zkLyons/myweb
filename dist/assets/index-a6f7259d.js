import{H as P,d as Y,r as f,c as ae,e as s,o as v,f as $,g as e,w as t,h as a,F as E,n as F,p as K,i as J,k as z,P as ie,I as U,S as pe,t as ee,A as M,m as ce,O as me,v as _e,D as ge,y as W,L as fe,z as X}from"./index-333c0485.js";const ye=(y,V,x)=>P.get(`/admin/product/${y}/${V}?category3Id=${x}`),le=()=>P.get("/admin/product/baseTrademark/getTrademarkList"),ne=y=>P.get("/admin/product/spuImageList/"+y),ue=y=>P.get("/admin/product/spuSaleAttrList/"+y),te=()=>P.get("/admin/product/baseSaleAttrList"),Se=y=>y.id?P.post("/admin/product/updateSpuInfo",y):P.post("/admin/product/saveSpuInfo",y),be=y=>P.post("/admin/product/saveSkuInfo",y),ve=y=>P.get("/admin/product/findBySpuId/"+y),Ve=y=>P.delete("/admin/product/deleteSpu/"+y),ke=["src"],Ae=Y({__name:"skuForm",emits:["changeScence2"],setup(y,{expose:V,emit:x}){let D=x,o=f([]),A=f([]),S=f([]),r=ae({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),w=f();const C=()=>{D("changeScence2",{flag:0,params:""})},h=async(L,d,_)=>{r.category3Id=_.category3Id,r.spuId=_.id,r.tmId=_.tmId;let c=await ie(L,d,_.category3Id);o.value=c.data;let I=await ue(_.id);A.value=I.data;let q=await ne(_.id);S.value=q.data},k=L=>{w.value.clearSelection(),w.value.toggleRowSelection(L,!0),r.skuDefaultImg=L.imgUrl},j=async()=>{r.skuAttrValueList=o.value.reduce((d,_)=>{if(_.attrIdAndValueId){let[c,I]=_.attrIdAndValueId.split(":");d.push({attrId:c,valueId:I})}return d},[]),r.skuSaleAttrValueList=A.value.reduce((d,_)=>{if(_.saleIdAndValueId){let[c,I]=_.saleIdAndValueId.split(":");d.push({saleAttrId:c,saleAttrValueId:I})}return d},[]),(await be(r)).code==200?(U({type:"success",message:"添加SKU成功"}),D("changeScence2",{flag:0,params:""})):U({type:"error",message:"添加SKU失败"})};return V({initSkuData:h}),(L,d)=>{const _=s("el-input"),c=s("el-form-item"),I=s("el-option"),q=s("el-select"),m=s("el-form"),p=s("el-table-column"),H=s("el-button"),n=s("el-table");return v(),$("div",null,[e(m,null,{default:t(()=>[e(c,{label:"sku名称"},{default:t(()=>[e(_,{placeholder:"SKU名称",modelValue:a(r).skuName,"onUpdate:modelValue":d[0]||(d[0]=l=>a(r).skuName=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"价格(元)"},{default:t(()=>[e(_,{placeholder:"价格(元)",type:"number",modelValue:a(r).price,"onUpdate:modelValue":d[1]||(d[1]=l=>a(r).price=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"重量(克)"},{default:t(()=>[e(_,{placeholder:"重量(克)",type:"number",modelValue:a(r).weight,"onUpdate:modelValue":d[2]||(d[2]=l=>a(r).weight=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"sku描述"},{default:t(()=>[e(_,{placeholder:"sku描述",type:"textarea",modelValue:a(r).skuDesc,"onUpdate:modelValue":d[3]||(d[3]=l=>a(r).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"平台属性"},{default:t(()=>[e(m,{inline:"true"},{default:t(()=>[(v(!0),$(E,null,F(a(o),(l,g)=>(v(),K(c,{key:l.id,label:l.attrName,"label-width":"150px"},{default:t(()=>[e(q,{style:{width:"200px","margin-top":"10px"},modelValue:l.attrIdAndValueId,"onUpdate:modelValue":i=>l.attrIdAndValueId=i},{default:t(()=>[(v(!0),$(E,null,F(l.attrValueList,(i,N)=>(v(),K(I,{value:`${l.id}:${i.id}`,key:i.id,label:i.valueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(c,{label:"销售属性"},{default:t(()=>[e(m,null,{default:t(()=>[(v(!0),$(E,null,F(a(A),(l,g)=>(v(),K(c,{label:l.saleAttrName,key:l.id,"label-width":"150px"},{default:t(()=>[e(q,{style:{width:"200px","margin-top":"10px"},modelValue:l.saleIdAndValueId,"onUpdate:modelValue":i=>l.saleIdAndValueId=i},{default:t(()=>[(v(!0),$(E,null,F(l.spuSaleAttrValueList,(i,N)=>(v(),K(I,{value:`${l.id}:${i.id}`,key:i.id,label:i.saleAttrValueName},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(c,{label:"图片名称"},{default:t(()=>[e(n,{border:"",data:a(S),ref_key:"table",ref:w},{default:t(()=>[e(p,{type:"selection",width:"80px",align:"center"}),e(p,{label:"图片"},{default:t(({row:l})=>[J("img",{src:l.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,ke)]),_:1}),e(p,{label:"名称",prop:"imgName"}),e(p,{label:"操作"},{default:t(({row:l})=>[e(H,{type:"primary",size:"small",onClick:g=>k(l)},{default:t(()=>d[4]||(d[4]=[z(" 设置默认 ")])),_:2,__:[4]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(c,null,{default:t(()=>[e(H,{type:"primary",onClick:j},{default:t(()=>d[5]||(d[5]=[z("保存")])),_:1,__:[5]}),e(H,{type:"primary",onClick:C},{default:t(()=>d[6]||(d[6]=[z("取消")])),_:1,__:[6]})]),_:1})]),_:1})])}}}),Ie=["src"],Ue=Y({__name:"spuForm",emits:["changeScence"],setup(y,{expose:V,emit:x}){let D=x,o=ae({category3Id:"",spuName:"",tmId:"",description:"",spuImageList:[],spuSaleAttrList:[]}),A=f([]),S=f([]),r=f([]),w=f([]),C=f(!1),h=f(""),k=f("");const j=()=>{D("changeScence",{flag:0,params:"update"})},L=async n=>{o=n;let l=await le(),g=await ne(n.id),i=await ue(n.id),N=await te();A.value=l.data,S.value=g.data,r.value=i.data,w.value=N.data},d=n=>{C.value=!0,h.value=n.url},_=n=>n.type=="image/png"||n.type=="image/jpeg"||n.type=="image/gif"?n.size/1024/1024>10?(U({type:"error",message:"图片大小大于10MB"}),!1):(U({type:"success",message:"上传成功"}),!0):(U({type:"error",message:"请上传png|jpeg|gif类型的文件。"}),!1);let c=pe(()=>w.value.filter(l=>r.value.every(g=>l.name!=g.saleAttrName)));const I=()=>{const[n,l]=k.value.split(":");let g={baseSaleAttrId:n,saleAttrName:l,spuSaleAttrValueList:[]};r.value.push(g),k.value=""},q=n=>{n.flag=!0,n.saleAttrValue=""},m=n=>{const{baseSaleAttrId:l,saleAttrValue:g}=n;let i={baseSaleAttrId:l,saleAttrValueName:g};if(g.trim()==""){U({type:"error",message:"属性值不能为空的"});return}if(n.spuSaleAttrValueList.find(T=>T.saleAttrValueName==g)){U({type:"error",message:"属性值重复"});return}n.spuSaleAttrValueList.push(i),n.flag=!1},p=async()=>{o.spuImageList=S.value.map(l=>({imgName:l.name,imgUrl:l.response&&l.response.data||l.url})),o.spuSaleAttrList=r.value,(await Se(o)).code==200?(U({type:"success",message:o.id?"更新成功":"添加成功"}),D("changeScence",{flag:0,params:o.id?"update":"add"})):U({type:"success",message:o.id?"更新成功":"添加成功"})};return V({initHasSpu:L,initAddSpu:async n=>{Object.assign(o,{category3Id:"",spuName:"",tmId:"",description:"",spuImageList:[],spuSaleAttrList:[]}),o.category3Id=n;let l=await le(),g=await te();A.value=l.data,w.value=g.data}}),(n,l)=>{const g=s("el-input"),i=s("el-form-item"),N=s("el-option"),T=s("el-select"),Q=s("Plus"),b=s("el-icon"),R=s("el-upload"),se=s("el-dialog"),O=s("el-button"),G=s("el-table-column"),oe=s("el-tag"),re=s("el-table"),de=s("el-form");return v(),$("div",null,[e(de,{"label-width":"100px"},{default:t(()=>[e(i,{label:"SPU名称",style:{width:"80%"}},{default:t(()=>[e(g,{style:{width:"80%"},placeholder:"请你输入spu名称",modelValue:a(o).spuName,"onUpdate:modelValue":l[0]||(l[0]=u=>a(o).spuName=u)},{default:t(()=>[z(ee(),1)]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"SPU品牌",style:{width:"50%"}},{default:t(()=>[e(T,{modelValue:a(o).tmId,"onUpdate:modelValue":l[1]||(l[1]=u=>a(o).tmId=u)},{default:t(()=>[e(N,{label:"1",value:"3344"}),e(N,{label:"22",value:"5566"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"SPU描述",style:{width:"80%"}},{default:t(()=>[e(g,{type:"textarea",placeholder:"请你输入spu描述",modelValue:a(o).description,"onUpdate:modelValue":l[2]||(l[2]=u=>a(o).description=u)},null,8,["modelValue"])]),_:1}),e(i,{label:"SPU图片"},{default:t(()=>[e(R,{"file-list":a(S),"onUpdate:fileList":l[3]||(l[3]=u=>M(S)?S.value=u:S=u),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":d,"before-upload":_},{default:t(()=>[e(b,null,{default:t(()=>[e(Q)]),_:1})]),_:1},8,["file-list"]),e(se,{modelValue:a(C),"onUpdate:modelValue":l[4]||(l[4]=u=>M(C)?C.value=u:C=u)},{default:t(()=>[J("img",{"w-full":"",src:a(h),alt:"Preview Image",style:{width:"90%"}},null,8,Ie)]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"SPU销售属性"},{default:t(()=>[e(T,{modelValue:a(k),"onUpdate:modelValue":l[5]||(l[5]=u=>M(k)?k.value=u:k=u),style:{width:"20%","margin-right":"10px"},placeholder:a(c).length?`还未选择${a(c).length}个`:"无"},{default:t(()=>[(v(!0),$(E,null,F(a(c),(u,B)=>(v(),K(N,{value:`${u.id}:${u.name}`,key:u.id,label:u.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"]),e(O,{type:"primary",icon:"Plus",onClick:I,disabled:!a(k)},{default:t(()=>l[6]||(l[6]=[z(" 添加销售属性 ")])),_:1,__:[6]},8,["disabled"]),e(re,{border:"",style:{margin:"10px 0px"},data:a(r)},{default:t(()=>[e(G,{label:"序号",type:"index",align:"center",width:"80px"}),e(G,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(G,{label:"销售属性值"},{default:t(({row:u})=>[(v(!0),$(E,null,F(u.spuSaleAttrValueList,(B,Z)=>(v(),K(oe,{style:{margin:"0px 5px"},onClose:we=>u.spuSaleAttrValueList.splice(Z,1),key:u.id,class:"mx-1",closable:""},{default:t(()=>[z(ee(B.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),u.flag==!0?(v(),K(g,{key:0,onBlur:B=>m(u),modelValue:u.saleAttrValue,"onUpdate:modelValue":B=>u.saleAttrValue=B,placeholder:"请你输入属性值"},null,8,["onBlur","modelValue","onUpdate:modelValue"])):ce("",!0),e(O,{type:"primary",icon:"Plus",onClick:B=>q(u)},null,8,["onClick"])]),_:1}),e(G,{label:"操作",width:"120px"},{default:t(({row:u,$index:B})=>[e(O,{type:"primary",icon:"Delete",onClick:Z=>a(r).splice(B,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(i,null,{default:t(()=>[e(O,{type:"primary",onClick:p},{default:t(()=>l[7]||(l[7]=[z("保存")])),_:1,__:[7]}),e(O,{type:"primary",onClick:j},{default:t(()=>l[8]||(l[8]=[z("取消")])),_:1,__:[8]})]),_:1})]),_:1})])}}}),xe=["src"],he=Y({__name:"index",setup(y){let V=f(0),x=f([]),D=f(0),o=f(1),A=f(3),S=me(),r=f({}),w=f({}),C=f([]),h=f(!1);_e(()=>S.c3Id,async()=>{S.c3Id&&k()});const k=async(m=1)=>{const p=await ye(o.value,A.value,S.c3Id);x.value=p.data.records,D.value=p.data.total,console.log(x.value,"++")},j=()=>{V.value=1,r.value.initAddSpu(S.c3Id)},L=m=>{V.value=m.flag,m.params=="update"?k(o.value):k()},d=m=>{V.value=1,r.value.initHasSpu(m)},_=m=>{V.value=2,console.log(m,"=="),w.value.initSkuData(S.c1Id,S.c2Id,m)},c=m=>{V.value=m.flag},I=async m=>{let p=await ve(m.id);p.code===200&&(C.value=p.data,h.value=!0)},q=async m=>{console.log(m.id);let p=await Ve(m.id);console.log(p),p.code==200?(U({type:"success",message:"删除成功"}),k(x.value.length>1?o.value:o.value-1)):U({type:"error",message:"删除失败"})};return ge(()=>{S.$reset()}),(m,p)=>{const H=s("Category"),n=s("el-button"),l=s("el-table-column"),g=s("el-popconfirm"),i=s("el-table"),N=s("el-pagination"),T=s("el-dialog"),Q=s("el-card");return v(),$("div",null,[e(H,{scence:a(V)},null,8,["scence"]),e(Q,{style:{margin:"10px 0"}},{default:t(()=>[W(J("div",null,[e(n,{type:"primary",icon:a(fe),disabled:!a(S).c3Id,onClick:j},{default:t(()=>p[3]||(p[3]=[z(" 添加SPU ")])),_:1,__:[3]},8,["icon","disabled"]),e(i,{border:"",style:{margin:"10px 0"},data:a(x)},{default:t(()=>[e(l,{label:"序号",type:"index",align:"center",width:"80px"}),e(l,{label:"SPU名称",prop:"spuName"}),e(l,{label:"SPU描述",prop:"description"}),e(l,{label:"SPU操作"},{default:t(({row:b})=>[e(n,{type:"primary",onClick:()=>_(b),size:"small",icon:"Plus",title:"添加SKU"},null,8,["onClick"]),e(n,{type:"primary",size:"small",icon:"Edit",title:"修改SPU",onClick:R=>d(b)},null,8,["onClick"]),e(n,{type:"primary",size:"small",icon:"View",title:"查看SKU列表",onClick:R=>I(b)},null,8,["onClick"]),e(g,{title:`你确定删除${b.spuName}?`,width:"200px",onConfirm:R=>q(b)},{reference:t(()=>[e(n,{type:"primary",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(N,{"current-page":a(o),"onUpdate:currentPage":p[0]||(p[0]=b=>M(o)?o.value=b:o=b),"page-size":a(A),"onUpdate:pageSize":p[1]||(p[1]=b=>M(A)?A.value=b:A=b),"page-sizes":[3,5,7,10],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:a(D),onCurrentChange:k},null,8,["current-page","page-size","total"])],512),[[X,a(V)===0]]),W(e(Ue,{ref_key:"spu",ref:r,onChangeScence:L},null,512),[[X,a(V)===1]]),W(e(Ae,{ref_key:"sku",ref:w,onChangeScence2:c},null,512),[[X,a(V)===2]]),e(T,{title:"SKU属性",modelValue:a(h),"onUpdate:modelValue":p[2]||(p[2]=b=>M(h)?h.value=b:h=b)},{default:t(()=>[e(i,{border:"",data:a(C)},{default:t(()=>[e(l,{label:"名字",prop:"skuName"}),e(l,{label:"价格",prop:"price"}),e(l,{label:"重量",prop:"weight"}),e(l,{label:"SKU图片"},{default:t(({row:b})=>[J("img",{src:b.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,xe)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{he as default};
