import{H as b,d as le,r as i,c as B,C as te,e as d,o as oe,f as ae,g as l,w as t,h as n,A as g,k as f,i as P,x as H,I as x,_ as re}from"./index-39dd0681.js";const ne=(s,r,_)=>b.get(`/admin/acl/role/${s}/${r}/?roleName=${_}`),se=s=>s.id?b.put("/admin/acl/role/update",s):b.post("/admin/acl/role/save",s),ie=s=>b.get("/admin/acl/permission/toAssign/"+s),de=(s,r)=>b.post(`/admin/acl/permission/doAssign/?roleId=${s}&permissionId=${r}`),ue=s=>b.delete("/admin/acl/role/remove/"+s),pe={class:"dialog-footer"},me={style:{flex:"auto"}},fe=le({__name:"index",setup(s){let r=i(1),_=i(5),y=i(""),N=i([]),U=i(0),u=i(!1),p=B({id:0,roleName:""}),q=i(0),V=i(),c=i(!1),z=i([]),w=i([]),A=i();const M=B({roleName:[{required:!0,trigger:"blur",validator:(a,e,v)=>{e.trim().length<2&&v(new Error("角色名称至少两个字符")),v()}}]}),S=a=>{k(a)},j=()=>{k()},K=()=>{y.value="",r.value=1,k()},L=()=>{u.value=!0,Object.assign(p,{roleName:"",id:0}),H(()=>{V.value.clearValidate()})},O=async()=>{await V.value.validate(),(await se(p)).code===200?(x({type:"success",message:p.id?"修改成功！":"添加成功！"}),k(p.id?r.value:1)):x({type:"error",message:p.id?"修改失败！":"添加失败！"}),u.value=!1},D=a=>{H(()=>{V.value.clearValidate()}),u.value=!0,p.id=a.id},k=async(a=1)=>{r.value=a;let e=await ne(r.value,_.value,y.value);e.code==200&&(N.value=e.data.records,U.value=e.data.total)};te(()=>{k()});const F=async a=>{c.value=!0,q.value=a.id;let e=await ie(a.id);e.code===200&&(console.log(e.data,"233"),z.value=e.data,w.value=[],I(z.value))},I=a=>{a.forEach(e=>{e.select&&(e.children?e.children.length===0&&w.value.push(e.id):w.value.push(e.id)),e.children&&e.children.length>0&&I(e.children)})},h={children:"children",label:"name"},G=async()=>{c.value=!1;let a=A.value.getCheckedKeys(),e=A.value.getHalfCheckedKeys(),v=a.concat(e);console.log(w.value),(await de(q.value,v)).code===200?x({type:"success",message:"权限分配成功！"}):x({type:"error",message:"权限分配失败！"})},J=async a=>{(await ue(a.id)).code===200?(x({type:"success",message:"删除成功！"}),k(N.value.length>1?r.value:r.value-1)):x({type:"error",message:"删除失败！"})};return(a,e)=>{const v=d("el-input"),R=d("el-form-item"),m=d("el-button"),$=d("el-form"),E=d("el-card"),C=d("el-table-column"),Q=d("el-popconfirm"),W=d("el-table"),X=d("el-pagination"),Y=d("el-dialog"),Z=d("el-tree"),ee=d("el-drawer");return oe(),ae("div",null,[l(E,null,{default:t(()=>[l($,{inline:"true",class:"form-top"},{default:t(()=>[l(R,{label:"角色名称",style:{width:"30%"}},{default:t(()=>[l(v,{modelValue:n(y),"onUpdate:modelValue":e[0]||(e[0]=o=>g(y)?y.value=o:y=o)},null,8,["modelValue"])]),_:1}),l(R,null,{default:t(()=>[l(m,{type:"primary",onClick:j},{default:t(()=>e[8]||(e[8]=[f("搜索")])),_:1,__:[8]}),l(m,{type:"primary",onClick:K},{default:t(()=>e[9]||(e[9]=[f("重置")])),_:1,__:[9]})]),_:1})]),_:1})]),_:1}),l(E,{style:{"margin-top":"10px"}},{default:t(()=>[l(m,{type:"primary",icon:"Plus",onClick:L},{default:t(()=>e[10]||(e[10]=[f(" 添加角色 ")])),_:1,__:[10]}),l(W,{border:"",style:{margin:"10px 0"},data:n(N)},{default:t(()=>[l(C,{label:"#",type:"index",align:"center"}),l(C,{label:"id",align:"center",prop:"id"}),l(C,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(C,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(C,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(C,{label:"操作",align:"center",width:"300px"},{default:t(({row:o})=>[l(m,{type:"primary",size:"small",icon:"UserFilled",onClick:T=>F(o)},{default:t(()=>e[11]||(e[11]=[f(" 分配权限 ")])),_:2,__:[11]},1032,["onClick"]),l(m,{type:"primary",size:"small",icon:"Edit",onClick:T=>D(o)},{default:t(()=>e[12]||(e[12]=[f(" 编辑 ")])),_:2,__:[12]},1032,["onClick"]),l(Q,{title:`你确定删除${o.name}吗？`,onConfirm:T=>J(o)},{reference:t(()=>[l(m,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>e[13]||(e[13]=[f(" 删除 ")])),_:1,__:[13]})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(X,{"current-page":n(r),"onUpdate:currentPage":e[1]||(e[1]=o=>g(r)?r.value=o:r=o),"page-size":n(_),"onUpdate:pageSize":e[2]||(e[2]=o=>g(_)?_.value=o:_=o),"page-sizes":[3,5,7,9],background:!0,layout:" sizes, prev, pager, next, jumper,->,total",total:n(U),onChange:S},null,8,["current-page","page-size","total"])]),_:1}),l(Y,{modelValue:n(u),"onUpdate:modelValue":e[5]||(e[5]=o=>g(u)?u.value=o:u=o),title:n(p).id?"编辑职位信息":"添加职位",width:"500"},{default:t(()=>[l($,{model:n(p),rules:M,ref_key:"formRef",ref:V},{default:t(()=>[l(R,{label:"职位名称",prop:"roleName"},{default:t(()=>[l(v,{placeholder:"请输入职位名称：",modelValue:n(p).roleName,"onUpdate:modelValue":e[3]||(e[3]=o=>n(p).roleName=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),footer:t(()=>[P("div",pe,[l(m,{onClick:e[4]||(e[4]=o=>g(u)?u.value=!1:u=!1)},{default:t(()=>e[14]||(e[14]=[f("取消")])),_:1,__:[14]}),l(m,{type:"primary",onClick:O},{default:t(()=>e[15]||(e[15]=[f("确认")])),_:1,__:[15]})])]),_:1},8,["modelValue","title"]),l(ee,{modelValue:n(c),"onUpdate:modelValue":e[7]||(e[7]=o=>g(c)?c.value=o:c=o)},{header:t(()=>e[16]||(e[16]=[P("h4",null,"职位权限分配",-1)])),default:t(()=>[l(Z,{style:{"max-width":"600px"},data:n(z),"show-checkbox":"","node-key":"id","default-checked-keys":n(w),props:h,"default-expand-all":"",ref_key:"tree",ref:A},null,8,["data","default-checked-keys"])]),footer:t(()=>[P("div",me,[l(m,{onClick:e[6]||(e[6]=o=>g(c)?c.value=!1:c=!1)},{default:t(()=>e[17]||(e[17]=[f("取消")])),_:1,__:[17]}),l(m,{type:"primary",onClick:G},{default:t(()=>e[18]||(e[18]=[f("确认")])),_:1,__:[18]})])]),_:1},8,["modelValue"])])}}});const ve=re(fe,[["__scopeId","data-v-920a9ffc"]]);export{ve as default};
